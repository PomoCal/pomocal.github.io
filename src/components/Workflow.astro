---
import { getLocaleFromUrl, t } from "../i18n/utils";

const locale = getLocaleFromUrl(Astro.url);
const i18n = t(locale);

const stepColors = ["#007AFF", "#FF6347", "#34C759", "#AF52DE"];
const steps = i18n.workflow.steps.map((step, index) => ({
    ...step,
    color: stepColors[index],
}));
---

<section id="workflow" class="section workflow">
    <div class="container">
        <div class="workflow-header reveal">
            <span class="section-label">{i18n.workflow.label}</span>
            <h2 class="section-title">
                {i18n.workflow.title1}<br />{i18n.workflow.title2}
            </h2>
            <p class="section-subtitle">
                {i18n.workflow.subtitle}
            </p>
        </div>

        <!-- Desktop SVG illustration -->
        <div class="wave-wrap reveal">
            <svg
                viewBox="0 0 900 340"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                class="wave-svg"
            >
                <defs>
                    <linearGradient
                        id="wg"
                        x1="0"
                        y1="0"
                        x2="900"
                        y2="0"
                        gradientUnits="userSpaceOnUse"
                    >
                        <stop offset="0%" stop-color="#FF69B4"></stop>
                        <stop offset="28%" stop-color="#FF8C42"></stop>
                        <stop offset="58%" stop-color="#FF69B4"></stop>
                        <stop offset="100%" stop-color="#5B9CFF"></stop>
                    </linearGradient>
                    <filter
                        id="circleshadow"
                        x="-20%"
                        y="-20%"
                        width="140%"
                        height="140%"
                    >
                        <feDropShadow
                            dx="0"
                            dy="3"
                            stdDeviation="5"
                            flood-color="#000"
                            flood-opacity="0.08"></feDropShadow>
                    </filter>
                </defs>

                <!-- S-curve -->
                <path
                    d="M 20,230 C 80,230 80,110 160,110 C 240,110 240,230 390,230 C 540,230 540,110 620,110 C 700,110 700,230 850,230"
                    stroke="url(#wg)"
                    stroke-width="5"
                    fill="none"
                    stroke-linecap="round"></path>
                <!-- Arrow tip -->
                <path
                    d="M845,222 L862,232 L845,242"
                    stroke="#5B9CFF"
                    stroke-width="3"
                    fill="none"
                    stroke-linecap="round"
                    stroke-linejoin="round"></path>

                <!-- Node 1: peak (160, 110) — label on TOP -->
                <text
                    x="160"
                    y="50"
                    text-anchor="middle"
                    font-family="'Inter', sans-serif"
                    font-weight="700"
                    font-size="17"
                    fill="#1D1D1F">{steps[0].title}</text
                >
                <text
                    x="160"
                    y="68"
                    text-anchor="middle"
                    font-family="'Inter', sans-serif"
                    font-weight="500"
                    font-size="12"
                    fill="#86868B">{steps[0].subtitle}</text
                >
                <circle
                    cx="160"
                    cy="110"
                    r="28"
                    fill="white"
                    filter="url(#circleshadow)"></circle>
                <circle
                    cx="160"
                    cy="110"
                    r="28"
                    fill="none"
                    stroke="#E5E5EA"
                    stroke-width="1"></circle>
                <!-- Icon: bookmark -->
                <g transform="translate(148, 98)">
                    <path
                        d="M4 3H16C16.5523 3 17 3.44772 17 4V18L10 14L3 18V4C3 3.44772 3.44772 3 4 3Z"
                        stroke="#007AFF"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        fill="none"></path>
                    <path
                        d="M6 8H14"
                        stroke="#007AFF"
                        stroke-width="1.5"
                        stroke-linecap="round"></path>
                    <path
                        d="M6 11H11"
                        stroke="#007AFF"
                        stroke-width="1.5"
                        stroke-linecap="round"></path>
                </g>

                <!-- Node 2: valley (390, 230) — label on BOTTOM -->
                <circle
                    cx="390"
                    cy="230"
                    r="28"
                    fill="white"
                    filter="url(#circleshadow)"></circle>
                <circle
                    cx="390"
                    cy="230"
                    r="28"
                    fill="none"
                    stroke="#E5E5EA"
                    stroke-width="1"></circle>
                <!-- Icon: clock -->
                <g transform="translate(378, 218)">
                    <circle
                        cx="12"
                        cy="12"
                        r="8"
                        stroke="#FF6347"
                        stroke-width="1.5"
                        fill="none"></circle>
                    <path
                        d="M12 8V12L15 15"
                        stroke="#FF6347"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"></path>
                </g>
                <text
                    x="390"
                    y="280"
                    text-anchor="middle"
                    font-family="'Inter', sans-serif"
                    font-weight="700"
                    font-size="17"
                    fill="#1D1D1F">{steps[1].title}</text
                >
                <text
                    x="390"
                    y="298"
                    text-anchor="middle"
                    font-family="'Inter', sans-serif"
                    font-weight="500"
                    font-size="12"
                    fill="#86868B">{steps[1].subtitle}</text
                >

                <!-- Node 3: peak (620, 110) — label on TOP -->
                <text
                    x="620"
                    y="50"
                    text-anchor="middle"
                    font-family="'Inter', sans-serif"
                    font-weight="700"
                    font-size="17"
                    fill="#1D1D1F">{steps[2].title}</text
                >
                <text
                    x="620"
                    y="68"
                    text-anchor="middle"
                    font-family="'Inter', sans-serif"
                    font-weight="500"
                    font-size="12"
                    fill="#86868B">{steps[2].subtitle}</text
                >
                <circle
                    cx="620"
                    cy="110"
                    r="28"
                    fill="white"
                    filter="url(#circleshadow)"></circle>
                <circle
                    cx="620"
                    cy="110"
                    r="28"
                    fill="none"
                    stroke="#E5E5EA"
                    stroke-width="1"></circle>
                <!-- Icon: calendar check -->
                <g transform="translate(608, 98)">
                    <rect
                        x="2"
                        y="4"
                        width="16"
                        height="14"
                        rx="2"
                        stroke="#34C759"
                        stroke-width="1.5"
                        fill="none"></rect>
                    <path d="M2 8H18" stroke="#34C759" stroke-width="1.5"
                    ></path>
                    <path
                        d="M6 2V6"
                        stroke="#34C759"
                        stroke-width="1.5"
                        stroke-linecap="round"></path>
                    <path
                        d="M14 2V6"
                        stroke="#34C759"
                        stroke-width="1.5"
                        stroke-linecap="round"></path>
                    <path
                        d="M8 12L10 14L13 11"
                        stroke="#34C759"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"></path>
                </g>

                <!-- Node 4: valley end (820, 225) — label on BOTTOM -->
                <circle
                    cx="820"
                    cy="225"
                    r="28"
                    fill="white"
                    filter="url(#circleshadow)"></circle>
                <circle
                    cx="820"
                    cy="225"
                    r="28"
                    fill="none"
                    stroke="#E5E5EA"
                    stroke-width="1"></circle>
                <!-- Icon: bar chart -->
                <g transform="translate(808, 213)">
                    <path
                        d="M4 16V11"
                        stroke="#AF52DE"
                        stroke-width="2"
                        stroke-linecap="round"></path>
                    <path
                        d="M8 16V7"
                        stroke="#AF52DE"
                        stroke-width="2"
                        stroke-linecap="round"></path>
                    <path
                        d="M12 16V10"
                        stroke="#AF52DE"
                        stroke-width="2"
                        stroke-linecap="round"></path>
                    <path
                        d="M16 16V4"
                        stroke="#AF52DE"
                        stroke-width="2"
                        stroke-linecap="round"></path>
                </g>
                <text
                    x="820"
                    y="275"
                    text-anchor="middle"
                    font-family="'Inter', sans-serif"
                    font-weight="700"
                    font-size="17"
                    fill="#1D1D1F">{steps[3].title}</text
                >
                <text
                    x="820"
                    y="293"
                    text-anchor="middle"
                    font-family="'Inter', sans-serif"
                    font-weight="500"
                    font-size="12"
                    fill="#86868B">{steps[3].subtitle}</text
                >
            </svg>
        </div>

        <!-- Mobile vertical timeline -->
        <div class="wave-mobile">
            {
                steps.map((step, index) => (
                    <div class={`wm-step reveal reveal-delay-${index + 1}`}>
                        <div
                            class="wm-num"
                            style={`background: ${step.color}15; color: ${step.color};`}
                        >
                            {String(index + 1).padStart(2, "0")}
                        </div>
                        <div class="wm-body">
                            <h3 class="wm-title">{step.title}</h3>
                            <span class="wm-sub">{step.subtitle}</span>
                        </div>
                    </div>
                ))
            }
        </div>
    </div>
</section>

<style>
    .workflow {
        background: var(--color-bg);
    }

    .workflow-header {
        text-align: center;
        margin-bottom: var(--space-3xl);
    }

    .workflow-header .section-subtitle {
        margin: 0 auto;
    }

    .wave-wrap {
        max-width: 840px;
        margin: 0 auto;
    }

    .wave-svg {
        width: 100%;
        height: auto;
        display: block;
    }

    /* Mobile */
    .wave-mobile {
        display: none;
    }

    @media (max-width: 768px) {
        .wave-wrap {
            display: none;
        }

        .wave-mobile {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            max-width: 320px;
            margin: 0 auto;
        }

        .wm-step {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .wm-num {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-sm);
            font-weight: 700;
            flex-shrink: 0;
        }

        .wm-body {
            flex: 1;
        }

        .wm-title {
            font-size: var(--font-size-base);
            font-weight: 700;
            color: var(--color-text-primary);
        }

        .wm-sub {
            font-size: var(--font-size-xs);
            color: var(--color-text-tertiary);
            display: block;
        }
    }
</style>
