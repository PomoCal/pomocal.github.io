---
import {
    getLocaleFromUrl,
    t,
    getLocalizedPath,
    getAlternateLocale,
} from "../i18n/utils";

const locale = getLocaleFromUrl(Astro.url);
const i18n = t(locale);
const altLocale = getAlternateLocale(locale);
const altPath = getLocalizedPath(altLocale);
---

<nav class="navbar">
    <div class="navbar-inner container">
        <a href={locale === "ko" ? "/" : "/en/"} class="navbar-brand">
            <img src="/images/app-icon.png" alt="PomoCal" class="navbar-logo" />
            <span class="navbar-name">PomoCal</span>
        </a>

        <!-- Desktop links -->
        <div class="navbar-links">
            <a href="#why" class="nav-link">{i18n.navbar.why}</a>
            <a href="#features" class="nav-link">{i18n.navbar.features}</a>
            <a href="#screenshots" class="nav-link">{i18n.navbar.screenshots}</a
            >
            <a href="#tech" class="nav-link">{i18n.navbar.techPrivacy}</a>
            <a href="#faq" class="nav-link">{i18n.navbar.faq}</a>

            <div class="navbar-divider-vertical"></div>

            <a
                href={altPath}
                class="navbar-lang-switcher"
                aria-label="Change Language"
            >
                <svg
                    width="16"
                    height="16"
                    viewBox="0 0 16 16"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <circle
                        cx="8"
                        cy="8"
                        r="6.5"
                        stroke="currentColor"
                        stroke-width="1.2"></circle>
                    <path
                        d="M1.5 8H14.5"
                        stroke="currentColor"
                        stroke-width="1.2"></path>
                    <path
                        d="M8 1.5C9.5 3 10.5 5.3 10.5 8C10.5 10.7 9.5 13 8 14.5"
                        stroke="currentColor"
                        stroke-width="1.2"></path>
                    <path
                        d="M8 1.5C6.5 3 5.5 5.3 5.5 8C5.5 10.7 6.5 13 8 14.5"
                        stroke="currentColor"
                        stroke-width="1.2"></path>
                </svg>
                <span>{altLocale.toUpperCase()}</span>
            </a>
        </div>
    </div>
</nav>

<!-- Hamburger button (mobile only) -->
<button
    class="hamburger"
    id="hamburger-btn"
    aria-label="메뉴 열기"
    aria-expanded="false"
>
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
</button>

<!-- Fullscreen mobile menu -->
<div class="mobile-menu" id="mobile-menu" aria-hidden="true">
    <div class="mobile-menu-content">
        <a href="#why" class="mobile-menu-link">{i18n.navbar.why}</a>
        <a href="#features" class="mobile-menu-link">{i18n.navbar.features}</a>
        <a href="#screenshots" class="mobile-menu-link"
            >{i18n.navbar.screenshots}</a
        >
        <a href="#tech" class="mobile-menu-link">{i18n.navbar.techPrivacy}</a>
        <a href="#faq" class="mobile-menu-link">{i18n.navbar.faq}</a>

        <div class="mobile-menu-divider"></div>

        <a href={altPath} class="mobile-menu-link mobile-menu-lang">
            <svg
                width="20"
                height="20"
                viewBox="0 0 16 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
            >
                <circle
                    cx="8"
                    cy="8"
                    r="6.5"
                    stroke="currentColor"
                    stroke-width="1.2"></circle>
                <path d="M1.5 8H14.5" stroke="currentColor" stroke-width="1.2"
                ></path>
                <path
                    d="M8 1.5C9.5 3 10.5 5.3 10.5 8C10.5 10.7 9.5 13 8 14.5"
                    stroke="currentColor"
                    stroke-width="1.2"></path>
                <path
                    d="M8 1.5C6.5 3 5.5 5.3 5.5 8C5.5 10.7 6.5 13 8 14.5"
                    stroke="currentColor"
                    stroke-width="1.2"></path>
            </svg>
            <span>{altLocale === "en" ? "English" : "한국어"}</span>
        </a>
    </div>
</div>

<script>
    const hamburger = document.getElementById("hamburger-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const mobileLinks = mobileMenu?.querySelectorAll(
        ".mobile-menu-link, .mobile-menu-cta",
    );

    function toggleMenu() {
        const isOpen = hamburger?.getAttribute("aria-expanded") === "true";
        hamburger?.setAttribute("aria-expanded", String(!isOpen));
        mobileMenu?.setAttribute("aria-hidden", String(isOpen));
        hamburger?.classList.toggle("is-active");
        mobileMenu?.classList.toggle("is-open");
        document.body.style.overflow = isOpen ? "" : "hidden";
    }

    hamburger?.addEventListener("click", toggleMenu);

    mobileLinks?.forEach((link) => {
        link.addEventListener("click", () => {
            if (mobileMenu?.classList.contains("is-open")) {
                toggleMenu();
            }
        });
    });
</script>

<style is:global>
    .navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background: rgba(245, 245, 247, 0.72);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    }

    .navbar-inner {
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 56px;
    }

    .navbar-brand {
        display: flex;
        align-items: center;
        gap: 10px;
        z-index: 1001;
    }

    .navbar-logo {
        width: 32px;
        height: 32px;
        border-radius: 8px;
    }

    .navbar-name {
        font-size: var(--font-size-lg);
        font-weight: 700;
        color: var(--color-text-primary);
    }

    .navbar-links {
        display: flex;
        align-items: center;
        gap: var(--space-xl);
    }

    .nav-link {
        font-size: var(--font-size-sm);
        font-weight: 500;
        color: var(--color-text-secondary);
        transition: color var(--transition-fast);
    }

    .nav-link:hover {
        color: var(--color-text-primary);
    }

    .navbar-divider-vertical {
        width: 1px;
        height: 16px;
        background: rgba(0, 0, 0, 0.1);
        margin: 0 4px;
    }

    .navbar-lang-switcher {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: var(--font-size-xs);
        font-weight: 600;
        color: var(--color-text-secondary);
        padding: 6px 10px;
        border-radius: 6px;
        transition: all 0.2s ease;
    }

    .navbar-lang-switcher:hover {
        color: var(--color-text-primary);
        background: rgba(0, 0, 0, 0.05);
    }

    /* Hamburger button */
    .hamburger {
        display: none;
        flex-direction: column;
        justify-content: center;
        gap: 5px;
        width: 36px;
        height: 36px;
        padding: 6px;
        background: none;
        border: none;
        cursor: pointer;
        z-index: 1001;
        border-radius: 8px;
        transition: background 0.2s ease;
    }

    .hamburger:hover {
        background: rgba(0, 0, 0, 0.05);
    }

    .hamburger-line {
        display: block;
        width: 100%;
        height: 2px;
        background: var(--color-text-primary);
        border-radius: 2px;
        transition:
            transform 0.3s ease,
            opacity 0.3s ease;
        transform-origin: center;
    }

    .hamburger.is-active .hamburger-line:nth-child(1) {
        transform: translateY(7px) rotate(45deg);
    }

    .hamburger.is-active .hamburger-line:nth-child(2) {
        opacity: 0;
    }

    .hamburger.is-active .hamburger-line:nth-child(3) {
        transform: translateY(-7px) rotate(-45deg);
    }

    /* Mobile menu overlay */
    .mobile-menu {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 999;
        background: rgba(245, 245, 247, 0.97);
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        opacity: 0;
        visibility: hidden;
        transition:
            opacity 0.3s ease,
            visibility 0.3s ease;
    }

    .mobile-menu.is-open {
        opacity: 1;
        visibility: visible;
    }

    .mobile-menu-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        gap: 8px;
        padding: var(--space-2xl);
    }

    .mobile-menu-link {
        font-size: clamp(1.5rem, 5vw, 2rem);
        font-weight: 700;
        color: var(--color-text-primary);
        padding: var(--space-md) var(--space-xl);
        border-radius: 12px;
        transition:
            background 0.2s ease,
            color 0.2s ease;
        letter-spacing: -0.01em;
        opacity: 0;
        transform: translateY(20px);
    }

    .mobile-menu.is-open .mobile-menu-link {
        opacity: 1;
        transform: translateY(0);
        transition:
            opacity 0.4s ease,
            transform 0.4s ease,
            background 0.2s ease;
    }

    .mobile-menu-link:hover,
    .mobile-menu-link:active {
        background: rgba(0, 0, 0, 0.04);
        color: var(--color-accent-blue);
    }

    .mobile-menu-divider {
        width: 48px;
        height: 1px;
        background: rgba(0, 0, 0, 0.1);
        margin: var(--space-md) 0;
        opacity: 0;
    }

    .mobile-menu.is-open .mobile-menu-divider {
        opacity: 1;
        transition: opacity 0.4s ease 0.2s;
    }

    .mobile-menu-lang {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 1.5rem;
    }

    /* Media query moved to global.css to fix specificity issues */
</style>
